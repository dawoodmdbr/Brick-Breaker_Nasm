     1                                  [org 0x0100]
     2 00000000 E97606                  jmp start
     3                                  
     4                                  ; =============== GAME DATA ===============
     5 00000003 00                      game_state: db 0        ; 0=menu, 1=playing, 2=paused, 3=gameover, 4=win
     6 00000004 03                      lives: db 3
     7 00000005 01                      level: db 1
     8 00000006 00                      combo: db 0
     9 00000007 00                      power_up: db 0          ; 0=none, 1=wide paddle, 2=multi-ball, 3=slow ball
    10                                  
    11                                  ; =============== SOUND FREQUENCIES ===============
    12 00000008 E803                    SOUND_HIT: dw 1000      ; Brick hit sound
    13 0000000A 2003                    SOUND_PADDLE: dw 800    ; Paddle bounce
    14 0000000C 9001                    SOUND_LOSE: dw 400      ; Life lost
    15 0000000E D007                    SOUND_WIN: dw 2000      ; Level complete
    16 00000010 DC05                    SOUND_POWERUP: dw 1500  ; Power-up collected
    17                                  
    18                                  ; =============== PADDLE DATA ===============
    19 00000012 2400                    paddle_x: dw 36         ; Column position
    20 00000014 17                      paddle_y: db 23         ; Row position
    21 00000015 0E                      paddle_width: db 14     ; Width in characters
    22 00000016 02                      paddle_speed: db 2      ; Movement speed
    23 00000017 3E                      paddle_color: db 0x3E   ; Cyan on black, bright
    24                                  
    25                                  ; =============== BALL DATA ===============
    26 00000018 2800                    ball_x: dw 40           ; Column (x10 for precision)
    27 0000001A DC00                    ball_y: dw 220          ; Row (x10 for precision)
    28 0000001C 0300                    ball_dx: dw 3           ; X velocity
    29 0000001E FDFF                    ball_dy: dw -3          ; Y velocity
    30 00000020 01                      ball_attached: db 1     ; 1=attached to paddle
    31 00000021 07                      ball_char: db 0x07      ; White circle
    32 00000022 0000                    prev_ball: dw 0         ; Previous ball position
    33                                  
    34                                  ; =============== SCORE & TIME ===============
    35 00000024 00000000                score: dd 0
    36 00000028 00000000                high_score: dd 0
    37 0000002C 0000                    time_sec: dw 0
    38 0000002E 00                      time_min: db 0
    39 0000002F 00                      timer_tick: db 0
    40                                  
    41                                  ; =============== BRICK DATA ===============
    42 00000030 3C00                    total_bricks: dw 60     ; 10 cols x 6 rows
    43 00000032 4E1E5E6E2ECE            brick_colors: db 0x4E, 0x1E, 0x5E, 0x6E, 0x2E, 0xCE  ; Different colors per row
    44 00000038 01<rep 3Ch>             brick_health: times 60 db 1  ; Health for each brick (some can take 2-3 hits)
    45                                  
    46                                  ; =============== PARTICLE EFFECTS ===============
    47 00000074 0000<rep 14h>           particles: times 20 dw 0  ; Particle positions for effects
    48 0000009C 00<rep 14h>             particle_active: times 20 db 0
    49                                  
    50                                  ; =============== OLD ISR ADDRESSES ===============
    51 000000B0 00000000                oldisr: dd 0
    52 000000B4 00000000                oldtmr: dd 0
    53                                  
    54                                  ; =============== STRINGS ===============
    55 000000B8 535550455220425249-     title_str: db 'SUPER BRICK BREAKER ULTIMATE'
    55 000000C1 434B20425245414B45-
    55 000000CA 5220554C54494D4154-
    55 000000D3 45                 
    56 000000D4 507265737320454E54-     subtitle_str: db 'Press ENTER to Start Adventure!'
    56 000000DD 455220746F20537461-
    56 000000E6 727420416476656E74-
    56 000000EF 75726521           
    57 000000F3 4172726F77204B6579-     inst1_str: db 'Arrow Keys: Move Paddle'
    57 000000FC 733A204D6F76652050-
    57 00000105 6164646C65         
    58 0000010A 53504143453A204C61-     inst2_str: db 'SPACE: Launch Ball'
    58 00000113 756E63682042616C6C 
    59 0000011C 503A20506175736520-     inst3_str: db 'P: Pause  |  ESC: Quit'
    59 00000125 207C20204553433A20-
    59 0000012E 51756974           
    60 00000132 53434F52453A            score_str: db 'SCORE:'
    61 00000138 4C495645533A            lives_str: db 'LIVES:'
    62 0000013E 4C4556454C3A            level_str: db 'LEVEL:'
    63 00000144 54494D453A              time_str: db 'TIME:'
    64 00000149 434F4D424F3A2078        combo_str: db 'COMBO: x'
    65 00000151 47414D45204F564552-     gameover_str: db 'GAME OVER!'
    65 0000015A 21                 
    66 0000015B 594F552057494E2120-     win_str: db 'YOU WIN! LEVEL COMPLETE!'
    66 00000164 4C4556454C20434F4D-
    66 0000016D 504C45544521       
    67 00000173 504155534544            paused_str: db 'PAUSED'
    68 00000179 507265737320502074-     continue_str: db 'Press P to Continue'
    68 00000182 6F20436F6E74696E75-
    68 0000018B 65                 
    69 0000018C 484947482053434F52-     highscore_str: db 'HIGH SCORE:'
    69 00000195 453A               
    70 00000197 574944452050414444-     powerup_wide: db 'WIDE PADDLE!'
    70 000001A0 4C4521             
    71 000001A3 4D554C54492042414C-     powerup_multi: db 'MULTI BALL!'
    71 000001AC 4C21               
    72 000001AE 534C4F57204D4F5449-     powerup_slow: db 'SLOW MOTION!'
    72 000001B7 4F4E21             
    73                                  
    74                                  ; =============== SOUND SUBROUTINE ===============
    75                                  play_sound:
    76 000001BA 50                          push ax
    77 000001BB 53                          push bx
    78 000001BC 51                          push cx
    79 000001BD 8B5E04                      mov bx, [bp+4]      ; Get frequency
    80                                      
    81 000001C0 B0B6                        mov al, 182
    82 000001C2 E643                        out 43h, al
    83 000001C4 89D8                        mov ax, bx
    84 000001C6 E642                        out 42h, al
    85 000001C8 88E0                        mov al, ah
    86 000001CA E642                        out 42h, al
    87                                      
    88 000001CC E461                        in al, 61h
    89 000001CE 0C03                        or al, 00000011b
    90 000001D0 E661                        out 61h, al
    91                                      
    92 000001D2 B9E803                      mov cx, 1000        ; Short beep duration
    93                                      sound_delay:
    94 000001D5 51                              push cx
    95 000001D6 B96400                          mov cx, 100
    96                                          sound_inner:
    97 000001D9 E2FE                                loop sound_inner
    98 000001DB 59                              pop cx
    99 000001DC E2F7                            loop sound_delay
   100                                      
   101 000001DE E461                        in al, 61h
   102 000001E0 24FC                        and al, 11111100b
   103 000001E2 E661                        out 61h, al
   104                                      
   105 000001E4 59                          pop cx
   106 000001E5 5B                          pop bx
   107 000001E6 58                          pop ax
   108 000001E7 C3                          ret
   109                                  
   110                                  ; =============== CLEAR SCREEN ===============
   111                                  clrscr:
   112 000001E8 06                          push es
   113 000001E9 50                          push ax
   114 000001EA 51                          push cx
   115 000001EB 57                          push di
   116                                      
   117 000001EC B800B8                      mov ax, 0xb800
   118 000001EF 8EC0                        mov es, ax
   119 000001F1 31FF                        xor di, di
   120 000001F3 B82000                      mov ax, 0x0020      ; Black background
   121 000001F6 B9D007                      mov cx, 2000
   122 000001F9 FC                          cld
   123 000001FA F3AB                        rep stosw
   124                                      
   125 000001FC 5F                          pop di
   126 000001FD 59                          pop cx
   127 000001FE 58                          pop ax
   128 000001FF 07                          pop es
   129 00000200 C3                          ret
   130                                  
   131                                  ; =============== DRAW BORDER WITH STYLE ===============
   132                                  draw_border:
   133 00000201 06                          push es
   134 00000202 50                          push ax
   135 00000203 57                          push di
   136 00000204 51                          push cx
   137                                      
   138 00000205 B800B8                      mov ax, 0xb800
   139 00000208 8EC0                        mov es, ax
   140                                      
   141                                      ; Top border (double line style)
   142 0000020A BFA000                      mov di, 160
   143 0000020D B95000                      mov cx, 80
   144 00000210 B8CD9F                      mov ax, 0x9FCD      ; Bright white on blue
   145 00000213 F3AB                        rep stosw
   146                                      
   147                                      ; Bottom border
   148 00000215 BF000F                      mov di, 3840
   149 00000218 B95000                      mov cx, 80
   150 0000021B B8CD9F                      mov ax, 0x9FCD
   151 0000021E F3AB                        rep stosw
   152                                      
   153                                      ; Side borders
   154 00000220 B91700                      mov cx, 23
   155 00000223 BF4001                      mov di, 320
   156                                      draw_left:
   157 00000226 26C705BA9F                      mov word [es:di], 0x9FBA
   158 0000022B 81C7A000                        add di, 160
   159 0000022F E2F5                            loop draw_left
   160                                      
   161 00000231 B91700                      mov cx, 23
   162 00000234 BFDE01                      mov di, 478
   163                                      draw_right:
   164 00000237 26C705BA9F                      mov word [es:di], 0x9FBA
   165 0000023C 81C7A000                        add di, 160
   166 00000240 E2F5                            loop draw_right
   167                                      
   168 00000242 59                          pop cx
   169 00000243 5F                          pop di
   170 00000244 58                          pop ax
   171 00000245 07                          pop es
   172 00000246 C3                          ret
   173                                  
   174                                  ; =============== PRINT STRING ===============
   175                                  print_string:
   176 00000247 55                          push bp
   177 00000248 89E5                        mov bp, sp
   178 0000024A 06                          push es
   179 0000024B 50                          push ax
   180 0000024C 51                          push cx
   181 0000024D 56                          push si
   182 0000024E 57                          push di
   183                                      
   184 0000024F B800B8                      mov ax, 0xb800
   185 00000252 8EC0                        mov es, ax
   186 00000254 8B7E08                      mov di, [bp+8]      ; Position
   187 00000257 8B7606                      mov si, [bp+6]      ; String address
   188 0000025A 8B4E04                      mov cx, [bp+4]      ; Length
   189 0000025D B40F                        mov ah, 0x0F        ; Bright white
   190                                      
   191                                      print_loop:
   192 0000025F 8A04                            mov al, [si]
   193 00000261 268905                          mov [es:di], ax
   194 00000264 83C702                          add di, 2
   195 00000267 46                              inc si
   196 00000268 E2F5                            loop print_loop
   197                                      
   198 0000026A 5F                          pop di
   199 0000026B 5E                          pop si
   200 0000026C 59                          pop cx
   201 0000026D 58                          pop ax
   202 0000026E 07                          pop es
   203 0000026F 5D                          pop bp
   204 00000270 C20600                      ret 6
   205                                  
   206                                  ; =============== PRINT NUMBER ===============
   207                                  print_number:
   208 00000273 55                          push bp
   209 00000274 89E5                        mov bp, sp
   210 00000276 06                          push es
   211 00000277 50                          push ax
   212 00000278 53                          push bx
   213 00000279 51                          push cx
   214 0000027A 52                          push dx
   215 0000027B 57                          push di
   216                                      
   217 0000027C B800B8                      mov ax, 0xb800
   218 0000027F 8EC0                        mov es, ax
   219 00000281 8B4604                      mov ax, [bp+4]      ; Number to print
   220 00000284 BB0A00                      mov bx, 10
   221 00000287 B90000                      mov cx, 0
   222                                      
   223                                      convert_digit:
   224 0000028A 31D2                            xor dx, dx
   225 0000028C F7F3                            div bx
   226 0000028E 80C230                          add dl, '0'
   227 00000291 52                              push dx
   228 00000292 41                              inc cx
   229 00000293 85C0                            test ax, ax
   230 00000295 75F3                            jnz convert_digit
   231                                      
   232 00000297 8B7E06                      mov di, [bp+6]      ; Position
   233                                      print_digits:
   234 0000029A 5A                              pop dx
   235 0000029B B60E                            mov dh, 0x0E        ; Yellow
   236 0000029D 268915                          mov [es:di], dx
   237 000002A0 83C702                          add di, 2
   238 000002A3 E2F5                            loop print_digits
   239                                      
   240 000002A5 5F                          pop di
   241 000002A6 5A                          pop dx
   242 000002A7 59                          pop cx
   243 000002A8 5B                          pop bx
   244 000002A9 58                          pop ax
   245 000002AA 07                          pop es
   246 000002AB 5D                          pop bp
   247 000002AC C20400                      ret 4
   248                                  
   249                                  ; =============== ANIMATED TITLE SCREEN ===============
   250                                  show_menu:
   251 000002AF 50                          push ax
   252 000002B0 E835FF                      call clrscr
   253                                      
   254                                     ; Animated title with color
   255 000002B3 B81202                  mov ax, 530        ; centered row for title
   256 000002B6 50                      push ax
   257 000002B7 B8[B800]                mov ax, title_str
   258 000002BA 50                      push ax
   259 000002BB B81D00                  mov ax, 29
   260 000002BE 50                      push ax
   261 000002BF E885FF                  call print_string
   262                                  
   263                                  ; Subtitle
   264 000002C2 B8B002                  mov ax, 688        ; centered row for subtitle
   265 000002C5 50                      push ax
   266 000002C6 B8[D400]                mov ax, subtitle_str
   267 000002C9 50                      push ax
   268 000002CA B81F00                  mov ax, 31
   269 000002CD 50                      push ax
   270 000002CE E876FF                  call print_string
   271                                  
   272                                  ; Instructions
   273 000002D1 B8F803                  mov ax, 1016
   274 000002D4 50                      push ax
   275 000002D5 B8[F300]                mov ax, inst1_str
   276 000002D8 50                      push ax
   277 000002D9 B81700                  mov ax, 23
   278 000002DC 50                      push ax
   279 000002DD E867FF                  call print_string
   280                                  
   281 000002E0 B89E04                  mov ax, 1182
   282 000002E3 50                      push ax
   283 000002E4 B8[0A01]                mov ax, inst2_str
   284 000002E7 50                      push ax
   285 000002E8 B81200                  mov ax, 18
   286 000002EB 50                      push ax
   287 000002EC E858FF                  call print_string
   288                                  
   289 000002EF B83605                  mov ax, 1334
   290 000002F2 50                      push ax
   291 000002F3 B8[1C01]                mov ax, inst3_str
   292 000002F6 50                      push ax
   293 000002F7 B81900                  mov ax, 25
   294 000002FA 50                      push ax
   295 000002FB E849FF                  call print_string
   296                                  
   297                                  ; High score display
   298 000002FE B88406                  mov ax, 1668
   299 00000301 50                      push ax
   300 00000302 B8[8C01]                mov ax, highscore_str
   301 00000305 50                      push ax
   302 00000306 B80B00                  mov ax, 11
   303 00000309 50                      push ax
   304 0000030A E83AFF                  call print_string
   305                                  
   306 0000030D B88606                  mov ax, 1670
   307 00000310 50                      push ax
   308 00000311 FF36[2800]              push word [high_score]
   309 00000315 E85BFF                  call print_number
   310                                  
   311                                      
   312 00000318 58                          pop ax
   313 00000319 C3                          ret
   314                                  
   315                                  ; =============== DRAW COLORFUL BRICKS ===============
   316                                  draw_bricks:
   317 0000031A 06                          push es
   318 0000031B 50                          push ax
   319 0000031C 53                          push bx
   320 0000031D 51                          push cx
   321 0000031E 52                          push dx
   322 0000031F 57                          push di
   323 00000320 56                          push si
   324                                      
   325 00000321 B800B8                      mov ax, 0xb800
   326 00000324 8EC0                        mov es, ax
   327                                      
   328 00000326 31F6                        xor si, si          ; Brick index
   329 00000328 BB0000                      mov bx, 0           ; Row counter
   330                                      
   331                                      brick_row_loop:
   332 0000032B 83FB06                          cmp bx, 6
   333 0000032E 7344                            jae bricks_done
   334                                          
   335 00000330 B90000                          mov cx, 0       ; Column counter
   336                                          brick_col_loop:
   337 00000333 83F90A                              cmp cx, 10
   338 00000336 7339                                jae next_brick_row
   339                                              
   340                                              ; Check if brick is still alive
   341 00000338 80BC[3800]00                        cmp byte [brick_health + si], 0
   342 0000033D 742E                                je skip_brick
   343                                              
   344                                              ; Calculate screen position
   345 0000033F 89D8                                mov ax, bx
   346 00000341 BA0500                              mov dx, 5
   347 00000344 F7E2                                mul dx
   348 00000346 83C003                              add ax, 3
   349 00000349 BAA000                              mov dx, 160
   350 0000034C F7E2                                mul dx
   351 0000034E 89C7                                mov di, ax
   352                                              
   353 00000350 89C8                                mov ax, cx
   354 00000352 BA0700                              mov dx, 7
   355 00000355 F7E2                                mul dx
   356 00000357 83C005                              add ax, 5
   357 0000035A D1E0                                shl ax, 1
   358 0000035C 01C7                                add di, ax
   359                                              
   360                                              ; Get brick color based on row
   361 0000035E 8A87[3200]                          mov al, [brick_colors + bx]
   362 00000362 B4DB                                mov ah, 0xDB    ; Solid block character
   363 00000364 86E0                                xchg ah, al
   364                                              
   365                                              ; Draw brick (7 chars wide)
   366 00000366 51                                  push cx
   367 00000367 B90700                              mov cx, 7
   368 0000036A F3AB                                rep stosw
   369 0000036C 59                                  pop cx
   370                                              
   371                                              skip_brick:
   372 0000036D 46                                  inc si
   373 0000036E 41                                  inc cx
   374 0000036F EBC2                                jmp brick_col_loop
   375                                          
   376                                          next_brick_row:
   377 00000371 43                              inc bx
   378 00000372 EBB7                            jmp brick_row_loop
   379                                      
   380                                      bricks_done:
   381 00000374 5E                          pop si
   382 00000375 5F                          pop di
   383 00000376 5A                          pop dx
   384 00000377 59                          pop cx
   385 00000378 5B                          pop bx
   386 00000379 58                          pop ax
   387 0000037A 07                          pop es
   388 0000037B C3                          ret
   389                                  
   390                                  ; =============== DRAW PADDLE WITH GLOW EFFECT ===============
   391                                  draw_paddle:
   392 0000037C 06                          push es
   393 0000037D 50                          push ax
   394 0000037E 51                          push cx
   395 0000037F 57                          push di
   396                                      
   397 00000380 B800B8                      mov ax, 0xb800
   398 00000383 8EC0                        mov es, ax
   399                                      
   400                                      ; Calculate paddle position
   401 00000385 A0[1400]                    mov al, [paddle_y]
   402 00000388 B400                        mov ah, 0
   403 0000038A B9A000                      mov cx, 160
   404 0000038D F7E1                        mul cx
   405 0000038F 89C7                        mov di, ax
   406                                      
   407 00000391 A1[1200]                    mov ax, [paddle_x]
   408 00000394 D1E0                        shl ax, 1
   409 00000396 01C7                        add di, ax
   410                                      
   411                                      ; Draw paddle with gradient effect
   412 00000398 8A0E[1500]                  mov cl, [paddle_width]
   413 0000039C B500                        mov ch, 0
   414 0000039E 8A26[1700]                  mov ah, [paddle_color]
   415 000003A2 B0DC                        mov al, 0xDC        ; Bottom half block
   416                                      
   417                                      paddle_draw_loop:
   418 000003A4 268905                          mov [es:di], ax
   419 000003A7 83C702                          add di, 2
   420 000003AA E2F8                            loop paddle_draw_loop
   421                                      
   422 000003AC 5F                          pop di
   423 000003AD 59                          pop cx
   424 000003AE 58                          pop ax
   425 000003AF 07                          pop es
   426 000003B0 C3                          ret
   427                                  
   428                                  ; =============== CLEAR BALL (previous position) ===============
   429                                  clear_ball:
   430 000003B1 06                          push es
   431 000003B2 50                          push ax
   432 000003B3 57                          push di
   433                                      
   434 000003B4 B800B8                      mov ax, 0xb800
   435 000003B7 8EC0                        mov es, ax
   436 000003B9 8B3E[2200]                  mov di, [prev_ball]
   437 000003BD 26C7052000                  mov word [es:di], 0x0020
   438                                      
   439 000003C2 5F                          pop di
   440 000003C3 58                          pop ax
   441 000003C4 07                          pop es
   442 000003C5 C3                          ret
   443                                  
   444                                  ; =============== DRAW BALL ===============
   445                                  draw_ball:
   446 000003C6 06                          push es
   447 000003C7 50                          push ax
   448 000003C8 53                          push bx
   449 000003C9 52                          push dx
   450 000003CA 57                          push di
   451                                      
   452 000003CB B800B8                      mov ax, 0xb800
   453 000003CE 8EC0                        mov es, ax
   454                                      
   455                                      ; Convert ball position to screen coordinates
   456 000003D0 A1[1A00]                    mov ax, [ball_y]
   457 000003D3 BB0A00                      mov bx, 10
   458 000003D6 31D2                        xor dx, dx
   459 000003D8 F7F3                        div bx              ; y / 10
   460 000003DA BBA000                      mov bx, 160
   461 000003DD F7E3                        mul bx
   462 000003DF 89C7                        mov di, ax
   463                                      
   464 000003E1 A1[1800]                    mov ax, [ball_x]
   465 000003E4 BB0A00                      mov bx, 10
   466 000003E7 31D2                        xor dx, dx
   467 000003E9 F7F3                        div bx              ; x / 10
   468 000003EB D1E0                        shl ax, 1
   469 000003ED 01C7                        add di, ax
   470                                      
   471 000003EF 893E[2200]                  mov [prev_ball], di
   472                                      
   473                                      ; Draw ball
   474 000003F3 26C7054F0F                  mov word [es:di], 0x0F4F    ; Bright white 'O'
   475                                      
   476 000003F8 5F                          pop di
   477 000003F9 5A                          pop dx
   478 000003FA 5B                          pop bx
   479 000003FB 58                          pop ax
   480 000003FC 07                          pop es
   481 000003FD C3                          ret
   482                                  
   483                                  ; =============== UPDATE BALL PHYSICS ===============
   484                                  update_ball:
   485 000003FE 50                          push ax
   486 000003FF 53                          push bx
   487 00000400 51                          push cx
   488 00000401 52                          push dx
   489                                      
   490                                      ; Check if ball is attached
   491 00000402 803E[2000]01                cmp byte [ball_attached], 1
   492 00000407 7526                        jne ball_moving
   493                                      
   494                                      ; Keep ball on paddle
   495 00000409 A1[1200]                    mov ax, [paddle_x]
   496 0000040C 8A1E[1500]                  mov bl, [paddle_width]
   497 00000410 B700                        mov bh, 0
   498 00000412 D1EB                        shr bx, 1
   499 00000414 01D8                        add ax, bx
   500 00000416 BB0A00                      mov bx, 10
   501 00000419 F7E3                        mul bx
   502 0000041B A3[1800]                    mov [ball_x], ax
   503                                      
   504 0000041E A0[1400]                    mov al, [paddle_y]
   505 00000421 FEC8                        dec al
   506 00000423 B400                        mov ah, 0
   507 00000425 BB0A00                      mov bx, 10
   508 00000428 F7E3                        mul bx
   509 0000042A A3[1A00]                    mov [ball_y], ax
   510 0000042D EB17                        jmp ball_done
   511                                      
   512                                      ball_moving:
   513                                      ; Update ball position
   514 0000042F A1[1800]                    mov ax, [ball_x]
   515 00000432 0306[1C00]                  add ax, [ball_dx]
   516 00000436 A3[1800]                    mov [ball_x], ax
   517                                      
   518 00000439 A1[1A00]                    mov ax, [ball_y]
   519 0000043C 0306[1E00]                  add ax, [ball_dy]
   520 00000440 A3[1A00]                    mov [ball_y], ax
   521                                      
   522                                      ; Check collisions
   523 00000443 E80500                      call check_collisions
   524                                      
   525                                      ball_done:
   526 00000446 5A                          pop dx
   527 00000447 59                          pop cx
   528 00000448 5B                          pop bx
   529 00000449 58                          pop ax
   530 0000044A C3                          ret
   531                                  
   532                                  ; =============== CHECK COLLISIONS ===============
   533                                  check_collisions:
   534 0000044B 50                          push ax
   535 0000044C 53                          push bx
   536 0000044D 51                          push cx
   537 0000044E 52                          push dx
   538                                      
   539                                      ; Convert to actual screen coords
   540 0000044F A1[1800]                    mov ax, [ball_x]
   541 00000452 BB0A00                      mov bx, 10
   542 00000455 31D2                        xor dx, dx
   543 00000457 F7F3                        div bx
   544 00000459 89C1                        mov cx, ax          ; CX = ball column
   545                                      
   546 0000045B A1[1A00]                    mov ax, [ball_y]
   547 0000045E BB0A00                      mov bx, 10
   548 00000461 31D2                        xor dx, dx
   549 00000463 F7F3                        div bx
   550 00000465 89C3                        mov bx, ax          ; BX = ball row
   551                                      
   552                                      ; Check left/right walls
   553 00000467 83F902                      cmp cx, 2
   554 0000046A 7607                        jbe bounce_x
   555 0000046C 83F94D                      cmp cx, 77
   556 0000046F 7302                        jae bounce_x
   557 00000471 EB0E                        jmp check_y
   558                                      
   559                                      bounce_x:
   560 00000473 F71E[1C00]                      neg word [ball_dx]
   561                                          ; Play sound
   562 00000477 FF36[0A00]                      push word [SOUND_PADDLE]
   563 0000047B E83CFD                          call play_sound
   564 0000047E 83C402                          add sp, 2
   565                                      
   566                                      check_y:
   567                                      ; Check top wall
   568 00000481 83FB02                      cmp bx, 2
   569 00000484 7618                        jbe bounce_y_down
   570                                      
   571                                      ; Check paddle collision
   572 00000486 A0[1400]                    mov al, [paddle_y]
   573 00000489 38C3                        cmp bl, al
   574 0000048B 7528                        jne check_bottom
   575                                      
   576                                      ; Check if ball is within paddle width
   577 0000048D A1[1200]                    mov ax, [paddle_x]
   578 00000490 39C1                        cmp cx, ax
   579 00000492 7221                        jb check_bottom
   580                                      
   581 00000494 89C2                        mov dx, ax
   582 00000496 0216[1500]                  add dl, [paddle_width]
   583 0000049A 39D1                        cmp cx, dx
   584 0000049C 7717                        ja check_bottom
   585                                      
   586                                      ; Paddle hit!
   587                                      bounce_y_down:
   588 0000049E A1[1E00]                        mov ax, [ball_dy]
   589 000004A1 85C0                            test ax, ax
   590 000004A3 7910                            jns check_bottom    ; Already moving down
   591 000004A5 F71E[1E00]                      neg word [ball_dy]
   592                                          ; Play sound
   593 000004A9 FF36[0A00]                      push word [SOUND_PADDLE]
   594 000004AD E80AFD                          call play_sound
   595 000004B0 83C402                          add sp, 2
   596 000004B3 EB1F                            jmp check_bricks
   597                                      
   598                                      check_bottom:
   599                                      ; Check if ball fell off bottom
   600 000004B5 83FB18                      cmp bx, 24
   601 000004B8 721A                        jb check_bricks
   602                                      
   603                                      ; Lost a life!
   604 000004BA FE0E[0400]                  dec byte [lives]
   605 000004BE C606[2000]01                mov byte [ball_attached], 1
   606 000004C3 C606[0600]00                mov byte [combo], 0
   607                                      ; Play lose sound
   608 000004C8 FF36[0C00]                  push word [SOUND_LOSE]
   609 000004CC E8EBFC                      call play_sound
   610 000004CF 83C402                      add sp, 2
   611 000004D2 EB22                        jmp collision_done
   612                                      
   613                                      check_bricks:
   614                                      ; Check brick collisions (rows 3-8)
   615 000004D4 83FB03                      cmp bx, 3
   616 000004D7 721D                        jb collision_done
   617 000004D9 83FB08                      cmp bx, 8
   618 000004DC 7718                        ja collision_done
   619                                      
   620                                      ; Calculate brick index
   621 000004DE 83EB03                      sub bx, 3
   622 000004E1 89D8                        mov ax, bx
   623 000004E3 BA0A00                      mov dx, 10
   624 000004E6 F7E2                        mul dx
   625                                      
   626 000004E8 83E905                      sub cx, 5
   627 000004EB 31D2                        xor dx, dx
   628 000004ED BB0700                      mov bx, 7
   629 000004F0 89C8                        mov ax, cx
   630 000004F2 F7F3                        div bx
   631 000004F4 01C8                        add ax, cx
   632                                      
   633                                      ; TODO: Check brick health and remove if hit
   634                                      
   635                                      collision_done:
   636 000004F6 5A                          pop dx
   637 000004F7 59                          pop cx
   638 000004F8 5B                          pop bx
   639 000004F9 58                          pop ax
   640 000004FA C3                          ret
   641                                  
   642                                  ; =============== DRAW HUD ===============
   643                                  draw_hud:
   644 000004FB 50                          push ax
   645                                      
   646                                      ; Score
   647 000004FC B8A400                      mov ax, 164
   648 000004FF 50                          push ax
   649 00000500 B8[3201]                    mov ax, score_str
   650 00000503 50                          push ax
   651 00000504 B80600                      mov ax, 6
   652 00000507 50                          push ax
   653 00000508 E83CFD                      call print_string
   654                                      
   655 0000050B B8B200                      mov ax, 178
   656 0000050E 50                          push ax
   657 0000050F FF36[2400]                  push word [score]
   658 00000513 E85DFD                      call print_number
   659                                      
   660                                      ; Lives
   661 00000516 B81401                      mov ax, 276
   662 00000519 50                          push ax
   663 0000051A B8[3801]                    mov ax, lives_str
   664 0000051D 50                          push ax
   665 0000051E B80600                      mov ax, 6
   666 00000521 50                          push ax
   667 00000522 E822FD                      call print_string
   668                                      
   669 00000525 B82201                      mov ax, 290
   670 00000528 50                          push ax
   671 00000529 A0[0400]                    mov al, [lives]
   672 0000052C B400                        mov ah, 0
   673 0000052E 50                          push ax
   674 0000052F E841FD                      call print_number
   675                                      
   676                                      ; Level
   677 00000532 B81C0F                      mov ax, 3868
   678 00000535 50                          push ax
   679 00000536 B8[3E01]                    mov ax, level_str
   680 00000539 50                          push ax
   681 0000053A B80600                      mov ax, 6
   682 0000053D 50                          push ax
   683 0000053E E806FD                      call print_string
   684                                      
   685 00000541 B82A0F                      mov ax, 3882
   686 00000544 50                          push ax
   687 00000545 A0[0500]                    mov al, [level]
   688 00000548 B400                        mov ah, 0
   689 0000054A 50                          push ax
   690 0000054B E825FD                      call print_number
   691                                      
   692 0000054E 58                          pop ax
   693 0000054F C3                          ret
   694                                  
   695                                  ; =============== KEYBOARD ISR ===============
   696                                  kbisr:
   697 00000550 50                          push ax
   698 00000551 06                          push es
   699                                      
   700 00000552 E460                        in al, 0x60
   701                                      
   702 00000554 803E[0300]00                cmp byte [game_state], 0
   703 00000559 750B                        jne game_keys
   704                                      
   705                                      ; Menu keys
   706 0000055B 3C1C                        cmp al, 0x1C        ; Enter
   707 0000055D 755E                        jne menu_done
   708 0000055F C606[0300]01                mov byte [game_state], 1
   709 00000564 EB57                        jmp kb_exit
   710                                      
   711                                      game_keys:
   712 00000566 803E[0300]01                cmp byte [game_state], 1
   713 0000056B 7550                        jne kb_exit
   714                                      
   715 0000056D 3C4B                        cmp al, 0x4B        ; Left arrow
   716 0000056F 7511                        jne check_right
   717 00000571 A1[1200]                    mov ax, [paddle_x]
   718 00000574 2A06[1600]                  sub al, [paddle_speed]
   719 00000578 83F803                      cmp ax, 3
   720 0000057B 7240                        jb kb_exit
   721 0000057D A3[1200]                    mov [paddle_x], ax
   722 00000580 EB3B                        jmp kb_exit
   723                                      
   724                                      check_right:
   725 00000582 3C4D                        cmp al, 0x4D        ; Right arrow
   726 00000584 7518                        jne check_space
   727 00000586 A1[1200]                    mov ax, [paddle_x]
   728 00000589 0206[1600]                  add al, [paddle_speed]
   729 0000058D 8A1E[1500]                  mov bl, [paddle_width]
   730 00000591 00D8                        add al, bl
   731 00000593 3C4D                        cmp al, 77
   732 00000595 7726                        ja kb_exit
   733 00000597 28D8                        sub al, bl
   734 00000599 A3[1200]                    mov [paddle_x], ax
   735 0000059C EB1F                        jmp kb_exit
   736                                      
   737                                      check_space:
   738 0000059E 3C39                        cmp al, 0x39        ; Space
   739 000005A0 7507                        jne check_pause
   740 000005A2 C606[2000]00                mov byte [ball_attached], 0
   741 000005A7 EB14                        jmp kb_exit
   742                                      
   743                                      check_pause:
   744 000005A9 3C19                        cmp al, 0x19        ; P
   745 000005AB 7507                        jne check_esc
   746 000005AD 8036[0300]03                xor byte [game_state], 3    ; Toggle pause
   747 000005B2 EB09                        jmp kb_exit
   748                                      
   749                                      check_esc:
   750 000005B4 3C01                        cmp al, 0x01        ; ESC
   751 000005B6 7505                        jne menu_done
   752 000005B8 C606[0300]03                mov byte [game_state], 3
   753                                      
   754                                      menu_done:
   755                                      kb_exit:
   756 000005BD B020                        mov al, 0x20
   757 000005BF E620                        out 0x20, al
   758                                      
   759 000005C1 07                          pop es
   760 000005C2 58                          pop ax
   761 000005C3 CF                          iret
   762                                  
   763                                  ; =============== TIMER ISR ===============
   764                                  timer:
   765 000005C4 50                          push ax
   766                                      
   767 000005C5 803E[0300]01                cmp byte [game_state], 1
   768 000005CA 7525                        jne timer_done
   769                                      
   770 000005CC FE06[2F00]                  inc byte [timer_tick]
   771 000005D0 803E[2F00]12                cmp byte [timer_tick], 18
   772 000005D5 721A                        jb timer_done
   773                                      
   774 000005D7 C606[2F00]00                mov byte [timer_tick], 0
   775 000005DC FF06[2C00]                  inc word [time_sec]
   776 000005E0 833E[2C00]3C                cmp word [time_sec], 60
   777 000005E5 720A                        jb timer_done
   778                                      
   779 000005E7 C706[2C00]0000              mov word [time_sec], 0
   780 000005ED FE06[2E00]                  inc byte [time_min]
   781                                      
   782                                      timer_done:
   783 000005F1 B020                        mov al, 0x20
   784 000005F3 E620                        out 0x20, al
   785 000005F5 58                          pop ax
   786 000005F6 CF                          iret
   787                                  
   788                                  ; =============== MAIN GAME LOOP ===============
   789                                  game_loop:
   790 000005F7 803E[0300]00                cmp byte [game_state], 0
   791 000005FC 7505                        jne check_playing
   792 000005FE E8AEFC                      call show_menu
   793 00000601 EBF4                        jmp game_loop
   794                                      
   795                                      check_playing:
   796 00000603 803E[0300]01                cmp byte [game_state], 1
   797 00000608 753C                        jne check_gameover
   798                                      
   799                                      ; Game is playing
   800 0000060A E8DBFB                      call clrscr
   801 0000060D E8F1FB                      call draw_border
   802 00000610 E807FD                      call draw_bricks
   803 00000613 E8E5FE                      call draw_hud
   804 00000616 E898FD                      call clear_ball
   805 00000619 E8E2FD                      call update_ball
   806 0000061C E8A7FD                      call draw_ball
   807 0000061F E85AFD                      call draw_paddle
   808                                      
   809                                      ; Small delay
   810 00000622 B9FFFF                      mov cx, 0xFFFF
   811                                      game_delay:
   812 00000625 90                              nop
   813 00000626 E2FD                            loop game_delay
   814                                      
   815                                      ; Check win/lose conditions
   816 00000628 803E[0400]00                cmp byte [lives], 0
   817 0000062D 7409                        je set_gameover
   818                                      
   819 0000062F 833E[3000]00                cmp word [total_bricks], 0
   820 00000634 7409                        je set_win
   821                                      
   822 00000636 EBBF                        jmp game_loop
   823                                      
   824                                      set_gameover:
   825 00000638 C606[0300]03                mov byte [game_state], 3
   826 0000063D EBB8                        jmp game_loop
   827                                      
   828                                      set_win:
   829 0000063F C606[0300]04                mov byte [game_state], 4
   830 00000644 EBB1                        jmp game_loop
   831                                      
   832                                      check_gameover:
   833 00000646 803E[0300]03                cmp byte [game_state], 3
   834 0000064B 7514                        jne check_win
   835                                      
   836                                      ; Game over screen
   837 0000064D E898FB                      call clrscr
   838 00000650 B84006                      mov ax, 1600
   839 00000653 50                          push ax
   840 00000654 B8[5101]                    mov ax, gameover_str
   841 00000657 50                          push ax
   842 00000658 B80A00                      mov ax, 10
   843 0000065B 50                          push ax
   844 0000065C E8E8FB                      call print_string
   845 0000065F EB12                        jmp wait_exit
   846                                      
   847                                      check_win:
   848 00000661 E884FB                      call clrscr
   849 00000664 B84006                      mov ax, 1600
   850 00000667 50                          push ax
   851 00000668 B8[5B01]                    mov ax, win_str
   852 0000066B 50                          push ax
   853 0000066C B81700                      mov ax, 23
   854 0000066F 50                          push ax
   855 00000670 E8D4FB                      call print_string
   856                                      
   857                                      wait_exit:
   858                                      ; Wait for ESC
   859 00000673 B400                        mov ah, 0
   860 00000675 CD16                        int 0x16
   861 00000677 EB65                        jmp cleanup
   862                                  
   863                                  ; =============== PROGRAM START ===============
   864                                  start:
   865                                      ; Initialize brick health (some bricks take multiple hits)
   866 00000679 B93C00                      mov cx, 60
   867 0000067C BF[3800]                    mov di, brick_health
   868 0000067F B001                        mov al, 1
   869 00000681 F3AA                        rep stosb
   870                                      
   871                                      ; Make some bricks tougher
   872 00000683 C606[4100]02                mov byte [brick_health + 9], 2
   873 00000688 C606[4B00]02                mov byte [brick_health + 19], 2
   874 0000068D C606[5500]03                mov byte [brick_health + 29], 3
   875 00000692 C606[5F00]02                mov byte [brick_health + 39], 2
   876 00000697 C606[6900]02                mov byte [brick_health + 49], 2
   877 0000069C C606[7300]03                mov byte [brick_health + 59], 3
   878                                      
   879                                      ; Hook interrupts
   880 000006A1 31C0                        xor ax, ax
   881 000006A3 8EC0                        mov es, ax
   882                                      
   883 000006A5 FA                          cli
   884 000006A6 26A12400                    mov ax, [es:9*4]
   885 000006AA A3[B000]                    mov [oldisr], ax
   886 000006AD 26A12600                    mov ax, [es:9*4+2]
   887 000006B1 A3[B200]                    mov [oldisr+2], ax
   888                                      
   889 000006B4 26A12000                    mov ax, [es:8*4]
   890 000006B8 A3[B400]                    mov [oldtmr], ax
   891 000006BB 26A12200                    mov ax, [es:8*4+2]
   892 000006BF A3[B600]                    mov [oldtmr+2], ax
   893                                      
   894 000006C2 26C7062400[5005]            mov word [es:9*4], kbisr
   895 000006C9 268C0E2600                  mov [es:9*4+2], cs
   896 000006CE 26C7062000[C405]            mov word [es:8*4], timer
   897 000006D5 268C0E2200                  mov [es:8*4+2], cs
   898 000006DA FB                          sti
   899                                      
   900                                      ; Start game
   901 000006DB E819FF                      call game_loop
   902                                  
   903                                  ; =============== CLEANUP ===============
   904                                  cleanup:
   905                                      ; Restore interrupts
   906 000006DE 31C0                        xor ax, ax
   907 000006E0 8EC0                        mov es, ax
   908                                      
   909 000006E2 FA                          cli
   910 000006E3 A1[B000]                    mov ax, [oldisr]
   911 000006E6 26A32400                    mov [es:9*4], ax
   912 000006EA A1[B200]                    mov ax, [oldisr+2]
   913 000006ED 26A32600                    mov [es:9*4+2], ax
   914                                      
   915 000006F1 A1[B400]                    mov ax, [oldtmr]
   916 000006F4 26A32000                    mov [es:8*4], ax
   917 000006F8 A1[B600]                    mov ax, [oldtmr+2]
   918 000006FB 26A32200                    mov [es:8*4+2], ax
   919 000006FF FB                          sti
   920                                      
   921                                      ; Clear screen and exit
   922 00000700 E8E5FA                      call clrscr
   923                                      
   924 00000703 B8004C                      mov ax, 0x4C00
   925 00000706 CD21                        int 0x21
